<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">users/user-router.js | CPCEED API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/TTUSDC/CPCEEDWebApp" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-createUser">createUser</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-deleteUser">deleteUser</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getUserById">getUserById</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-modifyUser">modifyUser</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-comparePassword">comparePassword</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-CreateUserCallback">CreateUserCallback</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-DeleteUserCallback">DeleteUserCallback</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-GetUserCallback">GetUserCallback</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-ModifyUserCallback">ModifyUserCallback</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-ComparePasswordNext">ComparePasswordNext</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-UserSchema">UserSchema</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-RouteCreateUser">RouteCreateUser</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">users/user-router.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">const express = require(&apos;express&apos;);
const userManager = require(&apos;./user-manager&apos;);
const authManager = require(&apos;../auth/auth-manager&apos;);

const userRouter = express.Router();

/**
 * Route for creating a new user
 * @typedef {function} RouteCreateUser
 * @param {Object} req - Express request object
 * @param {UserSchema} req.body - User to be created
 * @param {Object} res - Express result object
 * @param {string} res.body - UID of the created user if successful, else the
 *                          error message
 * @param {number} res.status - Indicates success or not
 */
userRouter.post(&apos;/&apos;, (req, res) =&gt; {
  userManager.createUser(req.body, (err, uid) =&gt; {
    if (err) {
      res.status(400).json(err).end();
    } else {
      // A User was created.
      res.status(201).json({ uid }).end();
    }
  });
});

/**
 * Route for modiying an existing user
 *
 * @endpoint /
 * @verb PUT
 * @param {Object}      req           Express request object
 * @param {string}      req.query.uid (OPTIONAL) UID of user ot be modified
 * @param {USER}        req.body      Updated fields of the user
 * @param {Object}      res           Express result object
 * @param {number}      status        200 on success, 400 if error
 * @param {USER|string} res.body      Modified user | error message
 * @param {TOKEN}       token         Admin | Modified User
 */
userRouter.put(&apos;/&apos;,
    authManager.verify,
    authManager.validateUidPermissions,
    (req, res) =&gt; {
      userManager.modifyUser(res.locals.uid, req.body, res.locals,
        (err, user) =&gt; {
          if (err) {
            res.status(400).json(err).end();
            return;
          }
          res.status(200).json(user).end();
        });
    });

/**
 * Route for deleting an existing user
 *
 * @endpoint /
 * @verb DELETE
 * @param {Object} req           Express request object
 * @param {string} req.query.uid (OPTIONAL) UID of user to be deleted
 * @param {TOKEN}  token         Admin | User to be deleted
 * @param {Object} res           Express result object
 */
userRouter.delete(&apos;/&apos;,
    authManager.verify,
    authManager.validateUidPermissions,
    (req, res) =&gt; {
      userManager.deleteUser(res.locals.uid, res.locals, (err, result) =&gt; {
        if (err) {
          res.status(400).json(err).end();
          return;
        }
        res.status(200).json(result).end();
      });
    });

/**
 * Route for getting an existing user
 *
 * @endpoint /
 * @verb GET
 * @param {Object} req           Express request object
 * @param {string} req.query.uid (OPTIONAL) UID of user to be retrieved
 * @param {TOKEN}  token          Admin | User being retrieved
 * @param {Object} res            Express result object
 */
userRouter.get(&apos;/&apos;,
    authManager.verify,
    authManager.validateUidPermissions,
    (req, res) =&gt; {
      const uid = res.locals.uid;
      userManager.getUserById(uid, {}, (err, user) =&gt; {
        if (err) {
          res.status(400).send(err).end();
          return;
        }

        if (!user) {
          res.status(404).end();
          return;
        }

        res.status(200).json(user).end();
      });
    });

module.exports = { userRouter };
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.5.2)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
